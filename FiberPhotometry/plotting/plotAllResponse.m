%% change for how the R drive is mounted on your computer
masterDir = 'R:\';
masterDir =  'R:\McKenzieLab\';

%%

dirs = [...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210818-135519']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210819-115556']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210820-145938']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210821-084618']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210822-091253']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210823-161754']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210824-091830']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210825-094340']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210826-091103']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210827-112030']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210830-134951']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210831-142633']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210901-111232']} ; ...
{[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h3-210902-122150']}; ...
];


%%


dirs = [...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210820-140801']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210821-081259']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210822-094611']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210823-165050']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210824-124626']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210825-101604']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210826-105416']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210827-104741']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210830-130702']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210831-135215']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210901-103622']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210902-114718']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210903-092753']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2m3-210907-135954']} ; ...
];

%%
dirs = [...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210817-130415']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210819-140301']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210823-150453']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210824-132044']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210825-110018']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210826-145040']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210827-135245']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210830-142332']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210831-145937']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210901-114549']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210902-125554']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210903-104015']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\DA2h1-210907-132533']} ; ...
];
%%
dirs = [...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-210927-120800']} ; ...
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-210928-144027']} ; ... 
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-210929-133405']} ; ... 
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-210930-155755']} ; ... 
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-210928-150304']} ; ... 
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-211001-125418']} ; ... 
 {[masterDir 'DonaldsonT\DA_animals_NEE-210817-124922\NE2h3-211002-130403']} ; ... 
];
%%
newCon = [];homeCage =[];
for i = 1:length(dirs)
    
    
    cd(dirs{i})
 [signal_DFoF,ts_data,ev_tims,ix,ts_PETH] = sm_PETH_DFoF(pwd,'newContext.mat',{'newContext','homeCage'},'photoBleachCorrection','quadratic','plotIntervals',[300 300],'returnedDataType','corrected');
   
% average all new context and home cage 
        newCon(i,:) = nanmean(signal_DFoF(ix{1}),1); %first element of ix is the first event type which is newContext
        homeCage(i,:) = nanmean(signal_DFoF(ix{2}),1); 
close all

end



%%

k  = gaussian2Dfilter([1000 1],[200 1]);
newCon1 =[];
homeCage1= [];
for i = 1:size(newCon,1)
    
    
    newCon1(i,:) = nanconvn(newCon(i,:),k');
    homeCage1(i,:) = nanconvn(homeCage(i,:),k');
    
end

%%

close all
figure
ax = tight_subplot(1,2);

axes(ax(1))
imagesc(ts_PETH,[],newCon1,[-1.5 2])
title('New Context')
ylabel('Days')
xlabel('Time from context entry')
axes(ax(2))
imagesc(ts_PETH,[],homeCage1,[-1.5 2])
title('Home cage')

xlabel('Time from context entry')%%

%%
%close all
figure
plot(ts_PETH,nanmean(newCon1),'b')
hold on
plot(ts_PETH,nanmean(homeCage1), 'k')
xlim([-300 300])


%%

%get index at time 0
[a,ix_0] = bestmatch(0,ts_PETH);

%get index at time 100
[a,ix_100] = bestmatch(60,ts_PETH);


u_response_novel = sum(newCon1(:,ix_0:ix_100),2);
u_response_HC = sum(homeCage1(:,ix_0:ix_100),2);


%%


% make scatter plot of homecage vs novel

figure
 plot(mean(homeCage1(:,ix_0:ix_100),2),mean(newCon1(:,ix_0:ix_100),2),'.')
 hold on
  plot(-.3:.1:1,-.3:.1:1)
  xlim([-.3 1])
  ylim([-.3 1])
